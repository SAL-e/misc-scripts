#!/bin/bash
## Black        0;30     Dark Gray     1;30
## Red          0;31     Light Red     1;31
## Green        0;32     Light Green   1;32
## Brown/Orange 0;33     Yellow        1;33
## Blue         0;34     Light Blue    1;34
## Purple       0;35     Light Purple  1;35
## Cyan         0;36     Light Cyan    1;36
## Light Gray   0;37     White         1;37
GREEN='\033[0;32m'
ORANGE='\033[0;33m'
NC='\033[0m' # No Color

get_new_version () {
  echo
  echo $1
  url=$2
  html="`wget -qO- ${url}`"

  version=$(
    <<< "${html}" \
    grep -P -o -e "$3"|
    head -n 1
  )
  if [ "$4" = "$version" ]; then
    echo -e "... ${GREEN}up to date${NC}."
  else
    echo -e "... ${ORANGE}updated${NC}. New version: $version"
  fi
}

# BorgBackup -> <a href="/borgbackup/borg/releases/tag/1.1.8">Release 1.1.8</a>
get_new_version 'BorgBackup (Deduplicating archiver with compression and encryption)' 'https://github.com/borgbackup/borg/releases/latest' '(?<=<a href=\"/borgbackup/borg/releases/tag/)(.*?)(?=\">Release )' '1.1.7'

##TODO: Add clonezilla

# Ditto -> var versionDots="3.22.20.0"
get_new_version 'Ditto (Clipboard Manager)' 'https://ditto-cp.sourceforge.io/' '(?<=var versionDots\=\")(.*?)(?=\")' '3.22.20.0'

##TODO: Add gparted

# mRemoteNG -> <a href="https://github.com/mRemoteNG/mRemoteNG/releases/tag/v1.76.11">Changelog</a>
get_new_version 'mRemoteNG (Multi-Remote Next Generation)' 'https://mremoteng.org/download' '(?<=<a href=\"https:\/\/github.com\/mRemoteNG\/mRemoteNG\/releases\/tag\/v)(.*?)(?=\">Changelog<\/a>)' '1.76.11'

# Notepad++ (npp) -> <title>Notepad++ v7.6.3 - Current Version</title>
get_new_version 'Notepad++ (Notepad++ is a free source code editor and Notepad replacement that supports several languages.)' 'https://notepad-plus-plus.org/download/' '(?<=<title>Notepad\+\+ v)(.*?)(?= - Current Version</title>)' '7.6.3'

#<optgroup label="United States"><option value="http://mirrors.nycbug.org/pub/opnsense/releases/19.1/">NYC*BUG (East Coast)</option><option value="http://mirror.wdc1.us.leaseweb.net/opnsense/releases/19.1/">LeaseWeb (East Coast)</option><option value="http://mirror.sfo12.us.leaseweb.net/opnsense/releases/19.1/">LeaseWeb (West Coast)</option></optgroup><br/>
get_new_version 'OPNsense (Your next open source firewall. High-end security made easy.)' 'https://opnsense.org/download/' '(?<=<optgroup label=\"United States\"><option value=\"http://mirrors.nycbug.org/pub/opnsense/releases/)(.*?)(?=/\">)' '18.1'

# OSMC -> <td><a href="http://download.osmc.tv/installers/diskimages/OSMC_TGT_vero3_20190105.img.gz">2018.12-1</a></td>
get_new_version 'OSMC (OSMC is a free and open source media center built for the people, by the people.)' 'https://osmc.tv/download/' '(?<=<td><a href=\"http://download.osmc.tv/installers/diskimages/OSMC_TGT_vero3_)(.*?)(?=.img.gz\">)' '20181101'

##TODO: Add Syncthing

# Tails -> <tr><td><a href="tails-amd64-3.12.iso.sig" title="tails-amd64-3.12.iso.sig">tails-amd64-3.12.iso.sig</a></td><td>
get_new_version 'Tails (The amnesic incognito live system)' 'https://tails.boum.org/torrents/files/' '(?<=<tr><td><a href=\"tails-amd64-)(.*?)(?=.iso.sig\" title=)' '3.11'

# VeraCrypt -> <br>&nbsp;&nbsp;&nbsp;&nbsp;For Windows: 1.23-Hotfix-2 (<span title="08/10/2018 09:10:00 AM">Monday October 8, 2018</span>)
get_new_version 'VeraCrypt (based on TrueCrypt 7.1a / Windows)' 'https://www.veracrypt.fr/en/Downloads.html' '(?<=<br>&nbsp;&nbsp;&nbsp;&nbsp;For Windows: )(.*?)(?= \(<span title=)' '1.23-Hotfix-2'

# YUMI -> <div id="button"><a href="/downloads/YUMI/YUMI-2.0.5.8.exe" target="_blank"
get_new_version 'YUMI (Multiboot USB Creator)' 'https://www.pendrivelinux.com/yumi-multiboot-usb-creator/' '(?<=<div id=\"button\"><a href=\"\/downloads\/YUMI\/YUMI-)(.*?)(?=.exe\" target=\"_blank\")' '2.0.6.3'

# YUMI-UEFI -> <div id="button"><a href="/downloads/YUMI/YUMI-UEFI-0.0.1.2.exe" target="_blank"
get_new_version 'YUMI-UEFI (Multiboot UEFI USB Creator)' 'https://www.pendrivelinux.com/yumi-multiboot-usb-creator/' '(?<=<div id=\"button\"><a href=\"\/downloads\/YUMI\/YUMI-UEFI-)(.*?)(?=.exe\" target=\"_blank\")' '0.0.1.2'
